# API для работы с обращениями (Appeals)

---

## 1. Создать обращение

**POST** `/api/appeals`

Создает новое обращение с темой и описанием проблемы.  
Статус обращения — `"новое"`.

### Тело запроса (JSON):

| Поле  | Тип    | Обязательное | Описание                         | Пример                          |
| ----- | ------ | ------------ | -------------------------------- | ------------------------------- |
| topic | string | Да           | Тема обращения, краткое описание | `"Проблема с интернетом"`       |
| text  | string | Да           | Подробное описание проблемы      | `"Интернет не работает с утра"` |

### Ответ:

Объект созданного обращения:

```json
{
  "_id": "60b8d6c7f1a2b72d887fce1a",
  "topic": "Проблема с интернетом",
  "text": "Интернет не работает с утра",
  "status": "новое",
  "createdAt": "2025-05-23T10:15:00.000Z",
  "__v": 0
}
```

### Ошибки:

- 400 — если `topic` или `text` отсутствуют
- 500 — внутренняя ошибка сервера

---

## 2. Взять обращение в работу

**PUT** `/api/appeals/:id/take`

Переводит обращение из статуса `"новое"` в `"в работе"`.
Записывает время начала работы (`takenAt`).

### Параметры:

| Параметр | Описание                | Пример                       |
| -------- | ----------------------- | ---------------------------- |
| id       | Идентификатор обращения | `"60b8d6c7f1a2b72d887fce1a"` |

### Ответ:

Обновленное обращение:

```json
{
  "_id": "60b8d6c7f1a2b72d887fce1a",
  "topic": "Проблема с интернетом",
  "text": "Интернет не работает с утра",
  "status": "в работе",
  "takenAt": "2025-05-23T12:00:00.000Z",
  "createdAt": "2025-05-23T10:15:00.000Z"
}
```

### Ошибки:

- 404 — обращение не найдено
- 400 — если обращение не имеет статус `"новое"`
- 500 — внутренняя ошибка сервера

---

## 3. Завершить обращение

**PUT** `/api/appeals/:id/complete`

Завершает обращение, переводит статус в `"завершено"`.
Обязательное поле — описание решения.

### Параметры:

| Параметр | Описание                | Пример                       |
| -------- | ----------------------- | ---------------------------- |
| id       | Идентификатор обращения | `"60b8d6c7f1a2b72d887fce1a"` |

### Тело запроса (JSON):

| Поле       | Тип    | Обязательное | Описание                          | Пример                                        |
| ---------- | ------ | ------------ | --------------------------------- | --------------------------------------------- |
| resolution | string | Да           | Краткое описание решения проблемы | `"Проблема с роутером устранена и проверена"` |

### Ответ:

```json
{
  "_id": "60b8d6c7f1a2b72d887fce1a",
  "topic": "Проблема с интернетом",
  "text": "Интернет не работает с утра",
  "status": "завершено",
  "resolution": "Проблема с роутером устранена и проверена",
  "completedAt": "2025-05-23T15:00:00.000Z",
  "takenAt": "2025-05-23T12:00:00.000Z",
  "createdAt": "2025-05-23T10:15:00.000Z"
}
```

### Ошибки:

- 404 — обращение не найдено
- 400 — если статус обращения не `"в работе"`
- 500 — внутренняя ошибка сервера

---

## 4. Отменить обращение

**PUT** `/api/appeals/:id/cancel`

Отменяет обращение, если оно не завершено.
Записывает причину отмены (необязательно).

### Параметры:

| Параметр | Описание                | Пример                       |
| -------- | ----------------------- | ---------------------------- |
| id       | Идентификатор обращения | `"60b8d6c7f1a2b72d887fce1a"` |

### Тело запроса (JSON):

| Поле   | Тип    | Обязательное | Описание                             | Пример                             |
| ------ | ------ | ------------ | ------------------------------------ | ---------------------------------- |
| reason | string | Нет          | Причина отмены обращения (если есть) | `"Проблема решена самостоятельно"` |

### Ответ:

```json
{
  "_id": "60b8d6c7f1a2b72d887fce1a",
  "topic": "Проблема с интернетом",
  "text": "Интернет не работает с утра",
  "status": "отменено",
  "cancellationReason": "Проблема решена самостоятельно",
  "createdAt": "2025-05-23T10:15:00.000Z"
}
```

### Ошибки:

- 404 — обращение не найдено
- 400 — если обращение уже завершено
- 500 — внутренняя ошибка сервера

---

## 5. Получить список обращений с фильтрацией по дате

**GET** `/api/appeals`

Возвращает список обращений с возможностью фильтрации по дате или диапазону.

### Параметры запроса:

| Параметр  | Тип    | Описание                              | Пример         |
| --------- | ------ | ------------------------------------- | -------------- |
| date      | string | Фильтр по конкретной дате (весь день) | `"2025-05-23"` |
| startDate | string | Начало диапазона (включительно)       | `"2025-05-20"` |
| endDate   | string | Конец диапазона (включительно)        | `"2025-05-23"` |

### Примеры запросов:

- `/api/appeals?date=2025-05-23`
- `/api/appeals?startDate=2025-05-20&endDate=2025-05-23`

### Ответ:

```json
[
  {
    "_id": "60b8d6c7f1a2b72d887fce1a",
    "topic": "Проблема с интернетом",
    "text": "Интернет не работает с утра",
    "status": "новое",
    "createdAt": "2025-05-23T10:15:00.000Z"
  },
  {
    "_id": "60b8d7c7f1a2b72d887fce1b",
    "topic": "Проблемы с принтером",
    "text": "Не печатает",
    "status": "в работе",
    "createdAt": "2025-05-22T09:00:00.000Z"
  }
]
```

### Ошибки:

- 500 — внутренняя ошибка сервера

---

## 6. Массовая отмена обращений "в работе"

**PUT** `/api/appeals/bulk-cancel`

Отменяет все обращения со статусом `"новое", "в работе"`, устанавливая статус `"отменено"` и причину `"Массовая отмена"`.

### Тело запроса: отсутствует

### Ответ:

```json
{
  "message": "Все обращения были отменены"
}
```

---

# Пример curl-запросов для тестирования

```bash
# Создать обращение
curl -X POST http://localhost:3000/api/appeals \
  -H "Content-Type: application/json" \
  -d '{"topic": "Проблема с интернетом", "text": "Интернет не работает"}'

# Взять обращение в работу
curl -X PUT http://localhost:3000/api/appeals/{id}/take

# Завершить обращение
curl -X PUT http://localhost:3000/api/appeals/{id}/complete \
  -H "Content-Type: application/json" \
  -d '{"resolution": "Перезагрузили роутер, проблема устранена"}'

# Отменить обращение
curl -X PUT http://localhost:3000/api/appeals/{id}/cancel \
  -H "Content-Type: application/json" \
  -d '{"reason": "Проблема решена самостоятельно"}'

# Получить обращения за конкретный день
curl http://localhost:3000/api/appeals?date=2025-05-23

# Массовая отмена обращений "в работе"
curl -X PUT http://localhost:3000/api/appeals/bulk-cancel
```
